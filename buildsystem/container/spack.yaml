spack:
  definitions:
  - pkgs:
    - exago@develop~ipopt+hiop+mpi~cuda ^hiop@0.4.1 ^openmpi
  - arch:
    - '%gcc@7.5.0 arch=linux-ubuntu18.04-x86_64'
  specs:
  - matrix:
    - [$pkgs]
    - [$arch]
  mirrors:
    pnnl: s3://spack
  config:
    clingo: true
    install_tree:
      padded_length: 128

  packages:
    petsc:
      version: [3.13.5]
      variants: +mpi~hypre~hdf5~metis~superlu-dist
  gitlab-ci:
    before_script:
      - git clone ${SPACK_REPO}
      - pushd spack && git checkout ${SPACK_CHECKOUT_VERSION} && popd
      - . "./spack/share/spack/setup-env.sh"
    script:
      - pushd ${SPACK_CONCRETE_ENV_DIR} && spack env activate --without-view . && popd
      - spack -d ci rebuild
    rebuild-index: false
    mappings:
    - match:
      - arch=linux-ubuntu18.04-x86_64
      runner-attributes:
        tags:
        - k8s
        - ikp
        - exasgd
        - basic
        image:
          name: spack/ubuntu-bionic
          entrypoint: [""]
