---
title: "DevOps for ExaScale - ExaSGD's journey"
author: 
 - Jaya Preethi Mohan
 - Sayef Azad Sakin
 - Jaelyn Litzinger
 - Cameron Rutherford
title-slide-attributes:
  data-background-image: /images/techfest2023-background.png
  data-background-opacity: "0.6"
filters:
  - include-code-files
format:
  pptx:
    reference-doc: template.pptx
    slide-level: 3
    toc: true
    toc-depth: 2
---

## Introduction

### Who are we?

- Jaya Preethi Moore
- Sayef Azad Sakin
- Cameron Rutherford

### What is ExaGO?

::::{.columns}

::: {.column}
ExaGO can take networks as large as the continental US...

![](../../viz/images/network_us.png){width=4in fig-align="left"}
:::

::: {.column}
... and generate information about loads/generators/renewables

![](../../viz/images/network_gen_us.png){width=4in fig-align="right}
:::

::::

### SCOPFLOW (Security Constrained OPFlow)

![](../../viz/images/network_gen_load_us.png){width=4in fig-align="right"}

### What is DevOps?

DevOps is complicated!

![](https://www.qentelli.com/sites/default/files/styles/insights_cover_846x479_/public/2021-04/Comprehensive%20List%20of%20DevOps%20Tools%202021.png?itok=f1JzPoT3){width=2in fig-align="left"}


### Exascale? ExaGO? ExaSGD?

::::{.columns}

::: {.column}

TODO - add video in slides manually.

{{< video https://www.youtube.com/watch?v=HmQjMEPhfDM start="11" >}}

Assembly video of Frontier, #1 on the top 500. [https://www.top500.org/lists/top500/2023/06/](https://www.top500.org/lists/top500/2023/06/)
:::

::: {.column}
ExaSGD requires ExaGO to be built with a variety of dependencies, and to run on anywhere from a Mac to the world's largest computer.
:::

::::

## Spack & Dependency Management (Sayef)

### HPC or cloud based applications has lots of dependencies {.scrollable}

- ExaGO depends directly on 55 packages with 598 other packages.
- Total interdependencies among the packages amounts to 5480, depending on platforms, compilers and other software configurations.

### Graph of dependencies is a nightmare

![HIOP packages Dependencies](images/hiop_graph_link.png)

### Graph of dependencies is a nightmare

![ExaGO packages Dependencies](images/exago_graph.png)

### Challenges building for HPC platforms

 - May need to build many variants of the same package
 - Require optimization for GPU or CPU
 - Multi-language support in the same software stack

### GitLab CI/CD Helps

:::: {.columns}

::: {.column}
```{.YAML include="../../buildsystem/spack/deception/spack.yaml" start-line=0 end-line=10}
```
:::

::: {.column}
Here is some the spack spec install of exago in GitLab CI/CD. These pipelines are invaluable in automating the testing and deployment of our code.
:::

::::

### HPC or cloud based applications has lots of dependencies {.scrollable}

- ExaGO depends directly on 55 packages with 598 other packages.
- Total interdependencies among the packages amounts to 5480, depending on platforms, compilers and other software configurations.

### Package managers

![ExaGO packages Dependencies](images/exago_graph.png)

### Package managers

- source code to binary for reproducibility and performance
- portable binary
- compiler and runtime libraries
- Spack manages dependencies

### Spack syntax for package customization

| spack install exago | unocnstrained |
| spack install exago@develop| @ custom version |
| spack install exago@develop %gcc10.2.0 | % custom compiler |
| spack install exago@develop %gcc10.2.0+hiop-mpi | +/- include exclude option |
| spack install exago@develop cppflags="-O3 –g3" | set compiler flags |
| spack install exago@develop target=icelake | set target architecture |
| spack install exago@develop ^cmake@3.26.3 | ^ dependency constraints |

### Spack supported profiling efforts

```{.YAML include="../../performance_analysis/spack.yaml" start-line=5 end-line=14}
```

### Useful Spack commands

- edit packages 

```
spack edit exago
```

```{.PYTHON include="../../tpl/spack/var/spack/repos/builtin/packages/exago/package.py" start-line=5 end-line=14}
```

### Useful Spack commands contd.

- concretize (create the dependency DAG and fills missing)

```
spack concretize -f
```

- install

```
spack install exago ^mvapich@2.3.7
spack install exago ^openmpi@4.1.4
```
Installing the same package with two different MPI implementation.
or Let spack choose

```
spack install exago ^mpi
```

### Some other Spack features

- Environments
- Mirrors (with E4S.)
- Binary hashes, reuse
![ExaGO packages Dependencies](figures/exago_graph.png)

## Linting / Tooling (Jaya)

1. Linting is a code analysis process to check for potential erros and compliance issues. 

1. Gitlab is one of the CI/CD tools for linting that supports linting/devops operations on different languages. 

1. Docker, Kubernetes, and Singularity are few of the contenarization and orchaestration tools to support devops workflows for HPC software package maintainance.

1. These tools enhances devops workflows with software code testing, bug identification, maintainance and colloboration. 


### Linting @ExaSGD Devops workflows

1. current linting (clang format, python format, file naming conventions, cmake format), run in CI pipelines for checking, can run manually to make in place changes. 

1. Transition to precommit for linting influnces various capabilities and ease of working. 

1. Pre-commit testing detects the  presence of bugs on configuration and the other project source files. 

1. It can be applied to the linting formats (clang format, python format, file naming conventions, cmake format). 

### Pre-commit
- TODO

### Documentation
- TODO

## CMake, buildsystems, and our C/Python/JS Stack (Cameron)

1. Language interoperability refers to a combination of different programming languages to select the most suitable programming language for efficiency. 

1. Due to the limitations and difference in different programming languages the language interoperability becomes challenging in certain times. 

1. C, Python and Java Script are the programming languages considered for the language interoperability in ExaSGD project. 

1. Python wrapper can interact with modules consists of C, Java Script and Python scripts in the working directory. 

### Language interoperability between C, Python and JS (Cameron)

- ExaGO's code base is based in C++
- The ExaGO Python bindings use an object-oriented API slightly different from the C++ API.
- The C++ API uses the application type in uppercase as the prefix for its methods, where they are native methods in Python.
pybind11 + pytest

### Slide 2

This year, we have introduced new Python bindings for ExaGO using pybind11 for the wrapper and pytest for the test suite. 
We have achieved coverage of the main OPFLOW functionality and use mpi4py to allow the Python module to interact with MPI.

### Test 9

The Spack package is aware of these bindings and will install the Python dependencies when the appropriate options are enabled.
To configure our testing for the Python bindings, we used pytest as a testing framework and then ran these tests within CMake. 

### Slide 3

This way, the dozens of unit tests for each Python application supported only show up as one test in any ctest run. 
We test two ways - one with MPI initialized in Python and the other with MPI initialized through ExaGO’s initialization function.
These pipelines are run independently from the C++ tests in GitLab CI pipelines and allow the development of the more experimental Python wrapper to go along with core C++ work without interrupting the success of CI pipelines. 

### Slide 4

added coverage of the SOPFLOW and SCOPFLOW applications in the Python wrapper, and so this testing infrastructure choice further supported parallel development.


### Cloud application / Frontend + LLM

- Some notes from Sichen with screenshots of progress, and rough arch outline?

###
::: {.notes}
Any Questions?
:::

## Template Slides (Section Header)

- Jaya Preethi Moore
- Sayef Azad Sakin
- Cameron Rutherford

### What is ExaGO?

::::{.columns}

::: {.column}
ExaGO can take networks as large as the continental US...

![](../../viz/images/network_us.png){width=4in fig-align="left"}
:::

::: {.column}
... and generate information about loads/generators/renewables

![](../../viz/images/network_gen_us.png){width=4in fig-align="right}
:::

::::

### SCOPFLOW (Security Constrained OPFlow)

![](../../viz/images/network_gen_load_us.png){width=4in fig-align="right"}

### What is DevOps?

DevOps is complicated!

![](https://www.qentelli.com/sites/default/files/styles/insights_cover_846x479_/public/2021-04/Comprehensive%20List%20of%20DevOps%20Tools%202021.png?itok=f1JzPoT3){width=2in fig-align="left"}


### Exascale? ExaGO? ExaSGD?

::::{.columns}

::: {.column}

TODO - add video in slides manually.

{{< video https://www.youtube.com/watch?v=HmQjMEPhfDM start="11" >}}

Assembly video of Frontier, #1 on the top 500. [https://www.top500.org/lists/top500/2023/06/](https://www.top500.org/lists/top500/2023/06/)
:::

::: {.column}
ExaSGD requires ExaGO to be built with a variety of dependencies, and to run on anywhere from a Mac to the world's largest computer.
:::

::::

### Content With Caption

Content with caption? Note the empty line between the two, and the (caption on top?)

![](../../viz/images/network_us.png){width=2in fig-align="left" fig-alt="Here is a visualization generated by ExaGO"}
