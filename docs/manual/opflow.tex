\chapter{Optimal power flow (OPFLOW)}\label{chap:opflow}

OPFLOW solves the full AC optimal power flow problem and provides various flexible features that can be toggled via run-time options. It has interfaces to different optimization solvers and includes different representations of the underlying equations (power-balance-polar and power-balance-cartesian) that can be used. By selecting the appropriate solver, OPFLOW can be executed on CPUs (in serial or parallel) or on GPUs.

\section{Formulation}
Optimal power flow is a general nonlinear programming problem with the following form
\begin{align}
\text{min. }& f(x) \\
&\text{s.t.} \nonumber \\
& g(x) = 0 \\
& h(x) \le 0 \\
& x^{\text{min}} \le x \le x^{\text{max}}
\end{align}
Here, $x$ are the decision variables with lower and upper bounds $x^{\text{min}}$ and $x^{\text{max}}$, respectively, $f(x)$ is the objective function, $g(x)$ and $h(x)$ are the equality and inequality constraints, respectively. In the following sections we describe what constitutes these different terms as used by OPFLOW.

\subsection{Variables and bounds} \label{subsec:opflow_var}

The different variables used in \opflow formulation are described in Table \ref{tab:opflow_vars}.

\begin{table}[!htbp]
\caption{Optimal power flow (OPFLOW) variables}
\small
  \begin{tabular}{|p{0.1\textwidth}|p{0.1\textwidth}|p{0.2\textwidth}|p{0.50\textwidth}|}
   \hline
    \textbf{Variable} & \textbf{Symbol} & \textbf{Bounds} & \textbf{Notes} \\
    \hline
    Generator real power dispatch & $\pgj$ & $\pminj \le \pgj \le \pmaxj$ & ~\\
    \hline
    Generator reactive power dispatch & $\qgj$ & $\qminj \le \qgj \le \qmaxj$ & ~ \\
    \hline
    Generator real power deviation & $\Deltapj$ & $-p^{\text{r}}_j \le \Deltapj \le p^{\text{r}}_j$ & \begin{itemize}[noitemsep,topsep=0pt,leftmargin=*]  \item Only used when \option{\opflowgensetpoint} or \option{\opflowuseagc} option is active \item $\Deltapj$ is the deviation from real power generation setpoint $\psetj$.\end{itemize} \\
    \hline
    Generator real power set-point & $\pgjset$ & $\pminj \le \pgjset \le \pmaxj$ & \begin{itemize}[noitemsep,topsep=0pt,leftmargin=*] \item Only used when \option{\opflowgensetpoint} or \option{\opflowuseagc} option is active. \end{itemize} \\
    \hline
    System power excess/deficit & $\Delta{P}$ & Unbounded & Only used when \option{\opflowuseagc} is active \\
    \hline
    Bus voltage angle & $\thetai$ & -$\pi \le \thetai \le \pi$ & 
    \begin{itemize}[noitemsep,topsep=0pt,leftmargin=*] 
    	\item Used with power balance polar model (\option{\opflowmodel~\pbpol}) 
	\item $\thetai$ is unbounded, except reference bus angle $\thetarefi$ which is fixed to 0 
    \end{itemize} \\
    \hline
    Bus voltage magnitude & $\vi$ & $\vmini \le \vi \le \vmaxi$ & \begin{itemize}[noitemsep,topsep=0pt,leftmargin=*] \item Used with power balance polar model (\option{\opflowmodel~\pbpol})\item $\vmini = \vmaxi = \vseti$ if fixed generator set point voltage option is active (\option{\opflowgensetpoint}) \end{itemize} \\
    \hline
    Bus voltage real part & $\vreali$ & $-\vmaxi \le \vreali \le \vmaxi$ & Used with power balance cartesian model (\option{\opflowmodel~ \pbcar})\\
    \hline
    Bus voltage imaginary part & $\vimagi$ & $-\vmaxi \le \vimagi \le \vmaxi$ & Used with power balance cartesian model (\option{\opflowmodel~\pbcar})\\
    \hline
    Bus real power mismatch & $\pmisi$ & Unbounded & Used when power mismatch variable option is active (\option{\opflowincludepowerimbalance 1}) \\
    \hline
    Bus reactive power mismatch & $\qmisi$ & Unbounded & Used when power mismatch variable option is active (\option{\opflowincludepowerimbalance 1}) \\
    \hline
    Real power load loss & $\Deltaplj$ & $0 \le \Deltaplj \le \plj $ & Used when load loss variable option is active (\option{\opflowincludeloadloss 1}) \\
    \hline
    Reactive power load loss & $\Deltaqlj$ & $0 \le \Deltaqlj \le \qlj$ & Used when load loss variable option is active (\option{\opflowincludeloadloss 1}) \\
    \hline
  %  Bus reactive power mismatch & $q^{mis}_i$ & Unbounded & Used when power mismatch variable option is active (\text{-opflow_include_powerimbalance_variables 1})
  %  \hline
  \end{tabular}
  \label{tab:opflow_vars}
\end{table}
Power imbalance variables are non-physical (slack) variables that measure the violation of power balance at buses. Having these variables (may) help in making the optimization problem easier to solve since they always ensure feasibility of the bus power balance constraints.

\subsection{Objective Function}\label{sec:opflow_obj}

The objective function for OPFLOW is given in (\ref{eq:opflow_obj})
\begin{equation}
\text{min.} ~ C(p^{\text{g}}) + C(\Delta p^{\text{g}}) + C(\Delta p^{\text{l}},\Delta q^{\text{l}}) + C(\Delta p,\Delta q)
\label{eq:opflow_obj}
\end{equation}
 
\subsubsection{Total generation cost $C(p^{\text{g}})$}
Needs option \opflowoption{\opflowobjective}{\mingencost}
\begin{equation}
C(p^{\text{g}}) = \sum_{\jinJgen} \costgj(\pgj)
\label{eq:opf_obj_mingencost}
\end{equation}
Here, $\costgj$ is a quadratic function of the form $\costgj = \agj{\pgj}^2 + \bgj\pgj + \cgj$.

\subsubsection{Total generation setpoint deviation $C(\Delta p^{\text{g}})$}
Needs option \opflowoption{\opflowobjective}{\mingensetpointdeviation} option
\begin{equation}
C(\Delta p^{\text{g}}) = \sum_{\jinJgen} ({\Deltapj}^2)
\label{eq:opf_obj_mingensetpointdev}
\end{equation}

\subsubsection{Load loss $C(\Delta p^{\text{l}},\Delta q^{\text{l}})$}
This term gets added to the objective when  \option{\opflowincludeloadloss} option is active. 
\begin{equation}
C(\Delta p^{\text{l}},\Delta q^{\text{l}}) =  \sum_{\jinJload} \sigmalj({\Deltaplj}^2 + {\Deltaqlj}^2)
\label{eq:opf_obj_minloadloss}
\end{equation}
The load loss penalty $\sigmalj$ can be set via the option \option{-opflow\_loadloss\_penalty}. The default is \$1000/MW for all loads.

\subsubsection{Power imbalance $C(\Delta p,\Delta q)$}
This term gets added to the objective when  \option{-opflow\_include_powerimbalance_variables} option is active. 
\begin{equation}
C(\Delta p,\Delta q) =  \sum_{i \in J^{bus}} \sigmai({\Delta p_i}^2 + {\Delta q_i}^2)
\label{eq:opf_obj_minpowerimbalance}
\end{equation}
The power imbalance cost $\sigmai$ can be set via the option \option{-opflow\_powerimbalance\_penalty}. The default is \$10,000/MW for all buses. Though the power imbalance variables $\Delta p_i,\Delta q_i$ are slack or non-physical, they can help in solving infeasible cases and provide a meaasure of the infeasibility. 

\subsection{Equality constraints}\label{sec:opflow_eq}

\subsubsection{Nodal power balance}
\begin{align}
\sum_{\substack{\jinJgen \\ A^{\text{g}}_{ij} \neq 0}} \pgj &=   \pshi + \sum_{\substack{\jinJload \\ A^{\text{l}}_{ij} \neq 0}} \plj + \sum_{\substack{\jinJbr \\ A^{\text{br}}_{oi} \neq 0}} \pbrjod + \sum_{\substack{\jinJbr \\ A^{\text{br}}_{id} \neq 0}} \pbrjdo \\
\sum_{\substack{\jinJgen \\ A^{\text{g}}_{ij} \neq 0}} \qgj &=  \qshi + \sum_{\substack{\jinJload \\ A^{\text{l}}_{ij} \neq 0}} \qlj +
\sum_{\substack{\jinJbr \\ A^{\text{br}}_{oi} \neq 0}} \qbrjod + \sum_{\substack{\jinJbr \\ A^{\text{br}}_{id} \neq 0}} \qbrjdo \\
\end{align}
where, the real and reactive power shunt consumption is given by (\ref{eq:opflow_sh_p}) and (\ref{eq:opflow_sh_q})


The real and reactive power flow $\pbrjod$, $\qbrjod$ for line $j$ from the origin bus $o$ to destination bus $d$ is given by (\ref{eq:opflow_br_podflow}) -- 
 (\ref{eq:opflow_br_qodflow})
and from destination bus $d$ to origin bus $o$ is given by (\ref{eq:opflow_br_pdoflow}) -- 
 (\ref{eq:opflow_br_qdoflow})

\subsubsection{Generator real power output}

When using \option{\opflowgensetpoint}, two extra variables $\pgjset$ and $\Deltapj$ are added for each generator. The generator real power output $\pgj$ is related to the power deviation $\Deltapj$ by the following relations
\begin{align}
  \pgjset + \Deltapj - \pgj = 0 \\
  \pgjset - p^{\text{g*}}_j = 0
\end{align}
The second equation here allows to fix the generator set point $\pgjset$ to a fixed value $p^{\text{g*}}_j$. Here, $p^{\text{g*}}_j$ is the set-point for the generator real power output, which can be thought of as an operator set or contractual agreement set-point.

\subsection{Inequality constraints}

\subsubsection{MVA flow on branches}
MVA flow limits at origin and destination buses for each line.
\begin{align}
  {\pbrjod}^2 + {\qbrjod}^2 \le {\srateAj}^2,~~\jinJbr\\
  {\pbrjdo}^2 + {\qbrjdo}^2 \le {\srateAj}^2,~~\jinJbr
\end{align}
To reduce the number of inequality constraints, only lines that are in service and having MVA A rating $\srateAj$ less than 10000 MVA are considered.

\subsubsection{Automatic generation control (AGC)}
With \option{\opflowuseagc}, two additional constraints are added for each participating generator to enforce the proportional generator redispatch participation as done in automatic generation control (AGC). These two equations are 
\begin{equation}
\begin{aligned}
  \left(\alpha^{\text{g}}_j\Delta{P} - \Deltapj\right)\left(\pgj - \pmaxj\right) \ge 0 \\
  \left((\Deltapj - \alpha_j\Delta{P}\right)\left(\pminj - \pgj\right) \ge 0
\end{aligned}
\label{eq:opflow_agc}
\end{equation}
Eq. \ref{eq:opflow_agc} enforces the generator set-point deviation to be equal to the generation participation when the generator has head-room available $\pminj \le \pgj \le \pmaxj$. Here, $\alpha^{\text{g}}_j$ is the generator participation factor which is the proportion of the power deficit/excess $\Delta{P}$ that the generator provides.

\subsubsection{Generator bus voltage control}
When the option \opflowoption{\opflowgenbusvoltage~\fixedwithinqbounds} is used, the generator bus voltage is fixed when the total reactive power generation available at the bus is within bounds. When it reaches its bounds, the voltage varies with the generator reactive power fixed at its bound. To implement this behavior, two inequality constraints are added for each generator bus
\begin{equation}
\begin{aligned}
(v^{\text{set}}_i - \vi)(q_i - q^{\text{max}_i}) \ge 0 \\
(\vi - v^{\text{set}}_i)(q^{\text{min}_i} - q_i) \ge 0
\end{aligned}
\label{eq:opflow_genbusvoltage}
\end{equation}
Here, $q_i$, $q^{\text{max}_i}$, and $q^{\text{min}_i}$ are the generated, maximum, and minimum reactive power at the bus, respectively.

\begin{comment}
\subssubection{Voltage magnitude for cartesian coordinates}
When using cartesian coordinates for voltages, inequality constraints (\ref{eq:opflow_ineq_vmag}) need to introduced to constraining the voltage magnitude within its bounds
\begin{equation}
  {\vmini}^2 \le {\vreali}^2 + {\vimagi}^2 \le {\vmaxi}^2,~~\iinJbus
\label{eq:opflow_ineq_vmag}
\end{equation}
\end{comment}

\section{Models}\label{sec:opflow_model}

\begin{table}[!h]
  \caption{OPFLOW models}
  \small
  \begin{tabular}{|p{0.2\textwidth}|p{0.4\textwidth}|p{0.2\textwidth}|p{0.15\textwidth}|}
    \hline
    \textbf{Model type} & \textbf{OPFLOW option (\opflowoption{\opflowmodel}{})} & \textbf{Compatible solvers} & \textbf{CPU-GPU}\\
    \hline
    Power balance with polar coordinates & \pbpol & IPOPT & CPU\\
    \hline
    Power balance with cartesian coordinates & \pbcar & IPOPT, TAO & CPU\\
    \hline
    Power balance with polar coordinates used with HIOP & {\pbpolhiop} & \hiop & CPU/GPU\\
    \hline
    Power balance with polar coordinates used with HIOP on GPU & {\pbpolrajahiop} & \hiop & GPU\\
    \hline
  \end{tabular}
  \label{tab:opflow_models}
\end{table}

\subsection{Power balance polar}

\subsubsection{Shunt power}
\begin{align}
&\pshi = \gshi{\vi}^2 \label{eq:opflow_sh_p} \\
&\qshi = -\bshi{\vi}^2 \label{eq:opflow_sh_q}
\end{align}

\subsubsection{Branch flows}
The real and reactive power flow $\pbrjod$, $\qbrjod$  from bus $o$ to bus $d$ on line $j$ is given by (\ref{eq:opflow_br_podflow}) -- 
 (\ref{eq:opflow_br_qodflow})


\begin{align}
\pbrjod &= g_{oo}{v^2_o} + v_ov_d(g_{od}\cos(\theta_o - \theta_d) + b_{od}\sin(\theta_o - \theta_d)) \label{eq:opflow_br_podflow}\\
\qbrjod &= -b_{oo}{v^2_o} + v_ov_d(-b_{od}\cos(\theta_o - \theta_d) + g_{od}\sin(\theta_o - \theta_d)) \label{eq:opflow_br_qodflow}
\end{align}

and from bus $d$ to bus $o$ is given by (\ref{eq:opflow_br_pdoflow}) -- (\ref{eq:opflow_br_qdoflow})

\begin{align}
\pbrjdo &= g_{dd}{v^2_d} + v_dv_o(g_{do}\cos(\theta_d - \theta_o) + b_{do}\sin(\theta_d - \theta_o))  \label{eq:opflow_br_pdoflow} \\
\qbrjdo &= -b_{dd}{v^2_d} + v_dv_o(-b_{do}\cos(\theta_d - \theta_o) + g_{do}\sin(\theta_d - \theta_o)) \label{eq:opflow_br_qdoflow}
\end{align}

\begin{comment}
\subsection{Power balance cartesian}
\end{comment}

\subsection{Power balance with HiOp}
Power balance formulation with polar coordinates used with \hiop \cite{hiop-manual} library. This model runs on CPU only, though the \hiop solver can run on GPU.

\subsection{Power balance with HiOp,RAJA,and Umpire}
Power balance formulation with polar coordinates used with \hiop and \raja. This model uses \raja~\cite{beckingsale2019raja} and Umpire \cite{beckingsale2019umpire} libraries to run \opflow calculations (objective, constraints, etc.) on the GPU. 

\section{Solvers}\label{sec:opflow_solvers}
\opflow can be used with a few different solvers. All the three solvers solve the optimization problem via a nonlinear interior-point algorithm.
\begin{enumerate}
  \item \ipopt~is a popular open-source package for solving nonlinear optimization problems. It is the most robust of the solvers implemented for solving \opflow. However, it can be run only on a single process and does not have GPU support. Option: \\
  \opflowoption{-opflow\_solver IPOPT}
  \item The Toolkit for Applied Optimization (\tao) is a toolkit available through \petsc for solving optimization problems. TAO includes a interior-point algorithm that is used by OPFLOW. The TAO algorithm is fully parallel, but is less robust compared to IPOPT. Currently, the TAO solver can only be used with the power balance cartesian model. Option:\\ \opflowoption{-opflow\_solver TAO} \opflowoption{-opflow\_model POWER\_BALANCE\_CARTESIAN}
  \item \hiop~ is a high-performance optimization library that implements an interior-point algorithm for solving nonlinear optimization problems. The library supports execution both on the CPU and the GPU. Options: \\ CPU: \opflowoption{-opflow\_solver HIOP} {\opflowoption{-opflow\_model POWER\_BALANCE\_HIOP}} \\ GPU: \opflowoption{-opflow\_solver HIOP} {\opflowoption{-opflow\_model PBPOLRAJAHIOP}} \\ The option \opflowoption{-hiop\_ipopt\_debug} can be used with the CPU option in order to use an adapter that verifies the correctness of the first and second order derivates when compared to \ipopt. This may be useful when debugging experimental changes.
\end{enumerate}

\begin{table}
  \centering
  \caption{OPFLOW Model-solver compatibility}
  \begin{tabular}{|c|c|c|c|}
    \hline
    Model & \ipopt & \hiop & \tao \\ \hline
    POWER\_BALANCE\_POLAR & \checkmark & & \\ \hline
    POWER\_BALANCE\_CARTESIAN & \checkmark &  & \checkmark \\ \hline
    POWER\_BALANCE\_HIOP & & \checkmark & \\ \hline
    PBPOLRAJAHIOP & & \checkmark & \\ \hline
  \end{tabular}
\label{tab:opflow_model_solver_compatibility}
\end{table}

\section{Input and Output}
The current \exago version only supports reading network file in \matpower format and can (optionally) write the output back in \matpower data file format.

\section{Usage}
\begin{lstlisting}
  ./opflow -netfile <netfilename>  <opflowoptions>
\end{lstlisting}

\section{Options}
See table \ref{tab:opflow_options}
\begin{table}[!htbp]
  \caption{OPFLOW options}
  \small
  \begin{tabular}{|p{0.4\textwidth}|p{0.3\textwidth}|p{0.3\textwidth}|}
    \hline
    \textbf{Option} & \textbf{Meaning} & \textbf{Values (Default value)} \\ \hline
    -netfile & Network file name & string $<$ 4096 characters (\href{https://gitlab.pnnl.gov/exasgd/frameworks/exago/-/blob/master/datafiles/case9/case9mod.m}{case9mod.m}) \\ \hline
    -print\_output & Print output to screen & 0 or 1 (0) \\ \hline
    -save\_output & Save output to file & 0 or 1 (0) \\ \hline
    -opflow\_model & Representation of network balance equations and bus voltages & See Table \ref{sec:opflow_model} (POWER\_BALANCE\_POLAR) \\ \hline
    -opflow\_solver & Optimization solver & See section \ref{sec:opflow_solvers} \\ \hline
    -opflow\_initialization & Type of initialization & See Table \ref{tab:opflow_initializations} (MIDPOINT) \\ \hline
    -opflow\_has\_gensetpoint & Uses generation set point and activates ramping variables & 0 or 1 (0) \\ \hline
    -opflow\_use\_agc & Uses AGC formulation in OPF & 0 or 1 (0) \\
    -opflow\_objective & type of objective function & See table \ref{tab:opflow_objtypes} (MIN\_GEN\_COST) \\ \hline
    -opflow\_genbusvoltage & Type of generator bus voltage control & See Table \ref{tab:opflow_genbusvoltage} (FIXED\_WITHIN\_QBOUNDS) \\ \hline
    -opflow\_ignore\_lineflow\_constraints & Ignore line flow constraints & 0 or 1 (0) \\ \hline
    -opflow\_include\_loadloss\_variables & Include load loss & 0 or 1 (0) \\ \hline
    -opflow\_include\_powerimbalance\_variables & Include power imbalance & 0 or 1 (0) \\ \hline
    -opflow\_loadloss\_penality & \$ penalty for load loss & real (1000) \\ \hline
    -opflow\_powerimbalance\_penalty & \$ penalty for power imbalance & real (10000) \\ \hline
    -opflow\_tolerance & Optimization solver tolerance & real (1e-6) \\ \hline 
  \end{tabular}
  \label{tab:opflow_options}
\end{table}

\begin{table}[!htbp]
  \centering
  \caption{OPFLOW initializations}
  \begin{tabular}{|c|c|}
    \hline
    \textbf{Initialization type} & \textbf{Meaning} \\ \hline
    MIDPOINT & Use mid-point of bounds \\ \hline
    FROMFILE & Use values from network file \\ \hline
    ACPF & Run AC power flow for initialization \\ \hline
    FLATSTART & Flat-start \\ \hline
  \end{tabular}
\label{tab:opflow_initializations}
\end{table}

\begin{table}[!htbp]
  \centering
  \caption{OPFLOW generator bus voltage control modes}
  \begin{tabular}{|c|c|}
    \hline
    \textbf{Voltage control type} & \textbf{Meaning} \\ \hline
    FIXED\_AT\_SETPOINT & Fixed at given set-point. Reactive power limits are ignored \\ \hline
    FIXED\_WITHIN\_QBOUNDS & Fixed within reactive power bounds \\ \hline
    VARIABLE\_WITHIN\_BOUNDS & Variable within voltage bounds \\ \hline
  \end{tabular}
\label{tab:opflow_genbusvoltage}
\end{table}

\begin{table}[!htbp]
  \centering
  \caption{OPFLOW objective function types}
  \begin{tabular}{|c|c|}
    \hline
    \textbf{Objective function} & \textbf{Meaning} \\ \hline
    MIN\_GEN\_COST & Minimize generation cost \\ \hline
    MIN\_GENSETPOINT\_DEVIATION & Minimize deviation (ramp up-down) from generataor set-point \\ \hline
    NO\_OBJ & No objective function \\ \hline
  \end{tabular}
\label{tab:opflow_objtypes}
\end{table}


\section{Examples}

Some \opflow example runs are provided with some sample output. Options values are the default values in table \ref{tab:opflow_options} unless otherwise specified. \opflowoption{-print_output} is only used in the first example to save space. Sample output is generated by running examples from the installation directory.

Example using the \tao solver:

\begin{lstlisting}
$ ./bin/opflow -netfile case9mod.m -opflow_solver TAO -opflow_model \
POWER_BALANCE_CARTESIAN -print_output
[ExaGO INFO]: -- Checking ... -options_file not passed     exists: no
[ExaGO INFO]: Creating OPFlow
TAO solve converged due to CONVERGED_GRTOL iterations 12
=============================================================
                Optimal Power Flow
=============================================================
Model                               POWER_BALANCE_CARTESIAN
Solver                              TAO
Objective                           MIN_GEN_COST
Initialization                      MIDPOINT
Load loss allowed                   NO
Power imbalance allowed             NO
Ignore line flow constraints        NO

Number of variables                 24
Number of equality constraints      19
Number of inequality constraints    27

Convergence status                  CONVERGED
Objective value                     4144.46

----------------------------------------------------------------------
Bus        Pd      Qd      Vm      Va      mult_Pmis      mult_Qmis
----------------------------------------------------------------------
1         0.00    0.00   1.100  -0.000      2102.91         0.00
2         0.00    0.00   1.095   3.927      2059.18         0.00
3         0.00    0.00   1.087   2.120      2065.15        -0.00
4         0.00    0.00   1.097  -1.993      2103.16         0.08
5        75.00   50.00   1.079  -3.060      2113.46         7.29
6        90.00   30.00   1.087  -3.927      2129.85         1.62
7         0.00    0.00   1.100   0.535      2059.57        -0.04
8       100.00   35.00   1.089  -1.720      2079.34         2.99
9         0.00    0.00   1.100  -0.135      2065.43        -0.09

--------------------------------------------------------------------------
From       To       Status     Sft      Stf     Slim     mult_Sf  mult_St
--------------------------------------------------------------------------
1          4          1       73.17    72.98   380.00     0.00     0.00
2          7          1      114.18   114.68   250.00     0.00     0.00
3          9          1       83.57    84.60   300.00     0.00     0.00
4          5          1       29.68    40.50   250.00     0.00     0.00
4          6          1       44.86    46.03   250.00     0.00     0.00
5          7          1       51.29    49.04   250.00     0.00     0.00
6          9          1       48.94    51.43   150.00     0.00     0.00
7          8          1       66.61    68.11   250.00     0.00     0.00
8          9          1       38.87    34.15   150.00     0.00     0.00

-------------------------------------------------------------------------
Gen  Status   Fuel      Pg      Qg      Pmin     Pmax     Qmin     Qmax
-------------------------------------------------------------------------
1     1    UNDEFINED   72.86    6.79    10.00   350.00  -300.00   300.00
2     1    UNDEFINED  114.07   -5.13    10.00   300.00  -300.00   300.00
3     1    UNDEFINED   80.21  -23.47    10.00   270.00  -300.00   300.00
[ExaGO INFO]: Finalizing opflow application.
\end{lstlisting}

Example using the \ipopt solver:

\begin{lstlisting}
$ ./bin/opflow -opflow_solver IPOPT -opflow_model POWER_BALANCE_POLAR \
-opflow_initialisation ACPF -opflow_objective MIN_GENSETPOINT_DEVIATION
[ExaGO INFO]: -- Checking ... -options_file not passed       exists: no
[ExaGO INFO]: Creating OPFlow

*************************************************************************
This program contains Ipopt, a library for large-scale nonlinear 
optimization. Ipopt is released as open source code under the 
Eclipse Public License (EPL).
*************************************************************************

This is Ipopt version 3.12.10, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:      125
Number of nonzeros in inequality constraint Jacobian.:      106
Number of nonzeros in Lagrangian Hessian.............:      159

Total number of variables............................:       32
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       24
                     variables with only upper bounds:        0
Total number of equality constraints.................:       24
Total number of inequality constraints...............:       36
        inequality constraints with only lower bounds:       15
   inequality constraints with lower and upper bounds:       21
        inequality constraints with only upper bounds:        0

iter objective  inf_pr inf_du lg(mu) ||d|| lg(rg) alpha_du alpha_pr  ls
0  5.9999880e-04 1.80e+00 2.60e-01 -1.0 0.00e+00 - 0.00e+00 0.00e+00  0
1  1.1156839e-02 1.31e+00 7.65e+01 -1.0 1.25e+00 - 9.33e-02 2.67e-01h 1
2  1.9076073e-02 1.26e+00 7.36e+01 -1.0 1.84e+00 - 3.08e-02 4.25e-02f 1
3  4.6334972e-02 1.17e+00 6.85e+01 -1.0 1.20e+00 - 1.51e-02 7.14e-02f 1
...
86  8.8262569e-02 3.01e-12 2.18e-03 -7.0 2.12e-05 - 1.00e+00 1.00e+00h 1
87  8.8262567e-02 3.55e-15 1.33e-10 -7.0 2.54e-09 - 1.00e+00 1.00e+00h 1

Number of Iterations....: 87

                               (scaled)                 (unscaled)
Objective...........:   8.8262566709882084e-02    8.8262566709882084e-02
Dual infeasibility..:   1.3274141855146966e-10    1.3274141855146966e-10
Constraint violation:   3.5527136788005009e-15    3.5527136788005009e-15
Complementarity.....:   9.0929465340161350e-08    9.0929465340161350e-08
Overall NLP error...:   9.0929465340161350e-08    9.0929465340161350e-08


Number of objective function evaluations             = 120
Number of objective gradient evaluations             = 88
Number of equality constraint evaluations            = 120
Number of inequality constraint evaluations          = 120
Number of equality constraint Jacobian evaluations   = 88
Number of inequality constraint Jacobian evaluations = 88
Number of Lagrangian Hessian evaluations             = 87
Total CPU secs in IPOPT (w/o function evaluations)   =      0.039
Total CPU secs in NLP function evaluations           =      0.011

EXIT: Optimal Solution Found.
[ExaGO INFO]: Finalizing opflow application.
\end{lstlisting}

Example using the \hiop solver on the CPU:

\begin{lstlisting}
$ ./bin/opflow -opflow_solver HIOP -opflow_model POWER_BALANCE_HIOP \
-opflow_initialisaition FLATSTART -hiop_compute_mode CPU \
-hiop_verbosity_level 3
[ExaGO INFO]: -- Checking ... -options_file not passed     exists: no
[ExaGO INFO]: Creating OPFlow
[Warning] Detected 1 fixed variables out of a total of 24.
[Warning] Fixed variables will be relaxed internally.
===============
Hiop SOLVER
===============
#
# Hiop options
#
...
# end of Hiop options

Using 1 MPI ranks.
---------------
Problem Summary
---------------
Total number of variables: 24
     lower/upper/lower_and_upper bounds: 16 / 16 / 16
Total number of equality constraints: 18
Total number of inequality constraints: 18
     lower/upper/lower_and_upper bounds: 18 / 18 / 18
iter  objective  inf_pr   inf_du  lg(mu)  alpha_du   alpha_pr linesrch
0  1.0318125e+04 1.800e+00  4.460e+03  -1.00  0.000e+00  0.000e+00  -(-)
1  7.7139414e+03 1.167e+00  2.900e+03  -1.00  6.255e-01  3.496e-01  1(s)
2  7.3644945e+03 1.075e+00  2.654e+03  -1.00  9.785e-03  8.498e-02  1(s)
...
13  4.1444605e+03 3.989e-10  3.273e-08 -7.00  1.000e+00  1.000e+00  1(h)
Successfull termination.
Total time 0.003 sec
Hiop internal time:     total 0.001 sec     avg iter 0.000 sec
    internal total std dev across ranks 0.000 percent
Fcn/deriv time:total=0.001sec (obj=0.000 grad=0.000 cons=0.000 \
                               Jac=0.000 Hess=0.001)
    Fcn/deriv total std dev across ranks 0.000 percent
Fcn/deriv #: obj 14 grad 14 eq cons 14 ineq cons 14 eq Jac 14 ineq Jac 14
Total KKT time 0.001 sec
        update init 0.000sec   update linsys 0.000 sec     fact 0.001 sec
        solve rhs-manip 0.000 sec     triangular solve 0.000 sec

[ExaGO INFO]: Finalizing opflow application.
\end{lstlisting}

Example using \hiop solver on the GPU:

\begin{lstlisting}
$mpirun -n 1 ./bin/opflow -opflow_model PBPOLRAJAHIOP -opflow_solver HIOP\
-hiop_compute_mode GPU -hiop_verbosity_level 3 \
-opflow_initialisation ACPF -opflow_ignore_lineflow_constraints 1 \
-netfile datafiles/case_ACTIVSg200.m
[ExaGO INFO]: -- Checking ... -options_file not passed         exists: no
[ExaGO INFO]: Creating OPFlow
[Warning] Detected 1 fixed variables out of a total of 476.
[Warning] Fixed variables will be relaxed internally.
===============
Hiop SOLVER
===============
#
# Hiop options
#
...
# end of Hiop options

Using 1 MPI ranks.
---------------
Problem Summary
---------------
Total number of variables: 476
     lower/upper/lower_and_upper bounds: 277 / 277 / 277
Total number of equality constraints: 400
Total number of inequality constraints: 0
     lower/upper/lower_and_upper bounds: 0 / 0 / 0
iter  objective  inf_pr  inf_du   lg(mu)  alpha_du   alpha_pr linesrch
0  2.6329021e+04 1.725e+00  2.321e+03  -1.00  0.000e+00  0.000e+00  -(-)
1  2.6227762e+04 1.723e+00  2.318e+03  -1.00  8.506e-04  1.026e-03  1(s)
2  2.6134620e+04 1.721e+00  2.314e+03  -1.00  1.697e-03  8.630e-04  1(s)
...
24  2.7557571e+04 3.921e-09  3.801e-07 -7.00  1.000e+00  1.000e+00  1(h)
Successfull termination.
Total time 4.555 sec
Hiop internal time:     total 4.538 sec     avg iter 0.189 sec
    internal total std dev across ranks 0.000 percent
Fcn/deriv time:     total=0.015 sec  ( obj=0.001 grad=0.001 cons=0.003 \
                                       Jac=0.004 Hess=0.006)
    Fcn/deriv total std dev across ranks 0.000 percent
Fcn/deriv #: obj 27 grad 25 eq cons 27 ineq cons 27 eq Jac 25 ineq Jac 25
Total KKT time 4.464 sec
        update init 0.004sec   update linsys 0.046 sec     fact 4.327 sec
        solve rhs-manip 0.072 sec     triangular solve 0.015 sec

[ExaGO INFO]: Finalizing opflow application.
\end{lstlisting}

